<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>workfinder_v1 | search</title>
    <link rel="website icon" type="png" href="https://pic.atserver186.jp/img/ATSERVER/icon.png">
    <link
    rel="stylesheet"
    href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
    crossorigin="anonymous"
    /><!--検索アイコンリンク-->
    <link rel="stylesheet" type="text/css" href="https://pic.atserver186.jp/js_css/workfinder_v1/pc/popup_c.css"/>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header>
        <a href="index.html">
          <img src="img/service_logo.png" alt="Workfinder_v1" style="width:150px;height:auto;">
        </a>
        <!-- ハンバーガーアイコン（常に前面） -->
        <div class="menu-toggle" id="menu-toggle">
        <span class="bar"></span>
        <span class="bar"></span>
        </div>

        <div class="search-container-02">
        <form class="search-form-header-search">
            <input class="search-box" type="text" id="searchTerm" placeholder="検索...">
            <button class="search-button" type="submit"><i class="fas fa-search"></i></button>
        </form>
        </div>

  <!-- サイドバー -->
  <nav class="sidebar" id="sidebar">
    <ul>
      <li><a href="../index.html">workfinder_v1 | home</a></li>
      <li><a href="https://github.com/t-aoki186/workfinder">GitHub</a></li>
      <li><a href="https://atserver186.jp/">作者ホームページ</a></li>
      <li><a href="link/index.html">公式SNS</a></li>
      <li><a href="https://atserver186.jp/inquiry/">お問い合わせ</a></li>
    </ul>
  </nav>
    </header>
    <a href="#top" class="fixed-btn"><img src="https://pic.atserver186.jp/js_css/workfinder_v1/pagetop_icon.png" class="bp_icon_i"></a>

<div class="container" style="margin-top: 10vh;">

        <div class="search-container-03">
        <form class="search-form">
            <input class="search-box" type="text" id="searchTerm" placeholder="検索...">
            <button class="search-button" type="submit"><i class="fas fa-search"></i></button>
        </form>
        </div>  

  <div class="title">
    <h1>検索結果</h1>
  </div>

<div id="content_to_search">
  <!--記事-->

    <!--検索処理中のローディング-->
    <div id="loading" style="display: none;">
      <div class="spinner"></div>
      <p style="color:#fff">検索中...</p>
    </div>
    <hr>
    <main>
      <!--リンク1-->
      <div class="blog-card">
        <!--以下の入力内容のようにご自身のリンクを追加してください-->
        <img src="archive/workfinder_v1/work1/image.png" alt="記事サムネイル">
        <a href="archive/workfinder_v1/work1/index.html" >
          <div class="content">
          <h2>workfinder_v1について</h2>
          <p>使い方などについて解説</p>
          <div class="Group">#workfinder</div>
          <p style="opacity: 0; position: absolute; height: 0; overflow: hidden;">
            表示されないが検索に使用されるテキスト。ここには検索結果に関連するキーワードや説明が含まれます。
          </p>   
          </div>
        </a>
      </div>
      <!--リンク2-->
      <div class="blog-card">
        <img src="https://pic.atserver186.jp/img/ATSERVER/Service/workfinder/v1/img.png" alt="記事サムネイル">
        <a href="archive/workfinder_v1/work2/index.html" >
          <div class="content">
          <h2>記事1</h2>
          <p>見出し</p>
          <div class="Group">#workfinder</div>
          <p style="opacity: 0; position: absolute; height: 0; overflow: hidden;">
            表示されないが検索に使用されるテキスト。ここには検索結果に関連するキーワードや説明が含まれます。
          </p>
          </div>
        </a>
      </div>
      <!--リンク3-->
      <div class="blog-card">
        <img src="https://pic.atserver186.jp/img/ATSERVER/Service/workfinder/v1/img.png" alt="記事サムネイル">
        <a href="archive/workfinder_v1/work3/index.html" >
          <div class="content">
          <h2>記事2</h2>
          <p>見出し</p>
          <div class="Group">#workfinder</div>
          <p style="opacity: 0; position: absolute; height: 0; overflow: hidden;">
            表示されないが検索に使用されるテキスト。ここには検索結果に関連するキーワードや説明が含まれます。
          </p>
          </div>
        </a>
      </div>
      <!--リンク4-->
      <div class="blog-card">
        <img src="https://pic.atserver186.jp/img/ATSERVER/Service/workfinder/v1/img.png" alt="記事サムネイル">
        <a href="archive/workfinder_v1/work4/index.html" >
          <div class="content">
          <h2>記事3</h2>
          <p>見出し</p>
          <div class="Group">#workfinder</div>
          <p style="opacity: 0; position: absolute; height: 0; overflow: hidden;">
            表示されないが検索に使用されるテキスト。ここには検索結果に関連するキーワードや説明が含まれます。
          </p>
          </div>
        </a>
      </div>
      <!--リンク5-->
      <div class="blog-card">
        <img src="https://pic.atserver186.jp/img/ATSERVER/Service/workfinder/v1/img.png" alt="記事サムネイル">
        <a href="archive/workfinder_v1/work5/index.html" >
          <div class="content">
          <h2>記事4</h2>
          <p>見出し</p>
          <div class="Group">#workfinder</div>
          <p style="opacity: 0; position: absolute; height: 0; overflow: hidden;">
            表示されないが検索に使用されるテキスト。ここには検索結果に関連するキーワードや説明が含まれます。
          </p>
          </div>
        </a>
      </div>
    </main>
  </div>




<!--記事-->
<!--ここまで検索範囲-->
</div>
</div>

  <hr>
  <div id="footer"></div>

<!--スクリプト-->
  <script>
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');

    menuToggle.addEventListener('click', () => {
      menuToggle.classList.toggle('active');
      sidebar.classList.toggle('active');
    });
  //共通部品の読み込み
  //footer
  fetch("footer.html")//このURLはフッター用のページのパスに合わせて変更してください
  .then((response) => response.text())
  .then((data) => document.querySelector("#footer").innerHTML = data);
        document.getElementById('menu-toggle').addEventListener('click', function() {
        document.getElementById('nav-menu').classList.toggle('show');
    });

        let highlights = [];            // ハイライトされた要素を格納する配列
        let currentIndex = -1;          // 現在のハイライト位置を示すインデックス
        let lastSearchTerm = '';        // 最後に検索された語句を保持する変数
        let searchTimer = null;         // 入力変更後に検索を遅延させるためのタイマー
        let isComposing = false;        // 入力中の状態を保持
        let caseSensitive = false;      // 大文字小文字の区別フラグ（デフォルトは区別しない）
    
        /**
         * 特殊文字をエスケープする関数
         * @param {string} string - エスケープする文字列
         * @returns {string} - エスケープされた文字列
         */
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
    
        /**
         * 検索を実行し、マッチしたテキストをハイライトする関数
         * @param {string} searchTerm - 検索語
         */
        function search(searchTerm) {
            if (!searchTerm || searchTerm === lastSearchTerm) return;
    
            lastSearchTerm = searchTerm;
            resetHighlights();
    
            searchTerm = escapeRegExp(searchTerm);
    
            const content = document.getElementById('content_to_search');
            searchAndHighlight(content, searchTerm);
    
            if (highlights.length > 0) {
                currentIndex = 0;
                scrollToHighlight(currentIndex);
            }
    
            document.getElementById('searchTerm').focus();
        }
    
        /**
         * テキストノード内で検索語を見つけてハイライトする関数
         * @param {Node} element - 検索対象のノード
         * @param {string} searchTerm - 検索語
         */
        function searchAndHighlight(element, searchTerm) {
            if (element.nodeType === 3) { // テキストノード
                const regex = new RegExp(searchTerm, caseSensitive ? 'g' : 'gi');
                const matches = element.textContent.match(regex);
                if (matches) {
                    const parent = element.parentNode;
                    const fragment = document.createDocumentFragment();
                    let lastIndex = 0;
                    matches.forEach(match => {
                        const matchStart = element.textContent.indexOf(match, lastIndex);
                        const matchEnd = matchStart + match.length;
    
                        fragment.appendChild(document.createTextNode(element.textContent.slice(lastIndex, matchStart)));
    
                        const span = document.createElement('span');
                        span.className = 'highlight';
                        span.textContent = match;
                        fragment.appendChild(span);
    
                        lastIndex = matchEnd;
                        highlights.push(span);
                    });
    
                    fragment.appendChild(document.createTextNode(element.textContent.slice(lastIndex)));
                    parent.replaceChild(fragment, element);
                }
            } else {
                Array.from(element.childNodes).forEach(child => searchAndHighlight(child, searchTerm));
            }
        }
    
        /**
         * 現在のハイライト要素にスクロールする関数
         * @param {number} index - ハイライト要素のインデックス
         */
        function scrollToHighlight(index) {
            if (highlights.length > 0) {
                highlights.forEach(el => el.classList.remove('current'));
                highlights[index].classList.add('current');
                highlights[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    
        /**
         * 次のハイライトに移動する関数
         */
        function nextHighlight() {
            if (highlights.length > 0) {
                currentIndex = (currentIndex + 1) % highlights.length;
                scrollToHighlight(currentIndex);
            }
        }
    
        /**
         * 前のハイライトに移動する関数
         */
        function previousHighlight() {
            if (highlights.length > 0) {
                currentIndex = (currentIndex - 1 + highlights.length) % highlights.length;
                scrollToHighlight(currentIndex);
            }
        }
    
        /**
         * ハイライトをリセットする関数
         */
        function resetHighlights() {
            highlights.forEach(el => {
                el.outerHTML = el.innerHTML;
            });
            highlights = [];
            currentIndex = -1;
            lastSearchTerm = '';
        }
        
      
          //検索をリセットし、入力枠にスクロールする関数

        //function resetSearch() {
        //    resetHighlights();
        //    document.getElementById('searchTerm').value = '';
        //   scrollToSearchInput();
        //}
    
        /**
         * 入力枠にスクロールする関数
         */
        //function scrollToSearchInput() {
        //    const searchInput = document.getElementById('searchTerm');
        //    searchInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        //    searchInput.focus(); // 入力枠にフォーカスも合わせる
        //}
        
        /**
         * 検索の処理を実行する関数
         */
function handleSearch() {
    const searchTerm = document.getElementById('searchTerm').value;
    const resultsContainer = document.querySelector("main");
    let noResultsMessage = document.getElementById("no-results-message");

    // 🔽 ローディング表示
    document.getElementById("loading").style.display = "flex";

    if (!noResultsMessage) {
        noResultsMessage = document.createElement("h1");
        noResultsMessage.id = "no-results-message";
        noResultsMessage.style.display = "none";
        noResultsMessage.style.textAlign = "center";
        noResultsMessage.style.color = "#fff";
        noResultsMessage.innerText = "検索結果がありません";
        resultsContainer.appendChild(noResultsMessage);
    }

    resetHighlights();

    if (searchTerm === '') {
        resetSearch();
        noResultsMessage.style.display = "none";
        // 🔽 ローディング非表示
        document.getElementById("loading").style.display = "none";
        return;
    }

    // 処理の重さを想定して非同期にする（小さな待ち時間を入れてUI更新を反映させる）
    setTimeout(() => {
        search(searchTerm);

        if (highlights.length === 0) {
            noResultsMessage.style.display = "block";
        } else {
            noResultsMessage.style.display = "none";
        }

        // 🔽 検索完了後ローディング非表示
        document.getElementById("loading").style.display = "none";
    }, 100); // ほんの少し遅延させてUI描画を保証
}


    
        document.getElementById('searchTerm').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const searchTerm = this.value;
                if (searchTerm) {
                    if (currentIndex === -1) {
                        handleSearch();
                    } else {
                        nextHighlight();
                    }
                }
            }
        });
    
        document.getElementById('searchTerm').addEventListener('input', function() {
            if (searchTimer) clearTimeout(searchTimer);
            if (!isComposing) {
                searchTimer = setTimeout(handleSearch, 500);
            }
        });
    
        document.getElementById('searchTerm').addEventListener('compositionstart', function() {
            isComposing = true;
        });
    
        document.getElementById('searchTerm').addEventListener('compositionend', function() {
            isComposing = false;
            handleSearch();
        });
    
        document.querySelectorAll('input[name="caseOption"]').forEach(radio => {
            radio.addEventListener('change', handleCaseOptionChange);
        });
    
        /**
         * 大文字小文字の区別設定を変更する関数
         */
        function handleCaseOptionChange() {
            caseSensitive = document.querySelector('input[name="caseOption"]:checked').value === 'sensitive';
            search(document.getElementById('searchTerm').value);
        }
        //検索語句が含まれていないblog-cardを非表示にする関数
    function searchAndHighlight(element, searchTerm) {
    let found = false; // 現在の blog-card に該当する検索語が含まれているか
    if (element.nodeType === 3) { // テキストノード
        const regex = new RegExp(searchTerm, caseSensitive ? 'g' : 'gi');
        const matches = element.textContent.match(regex);
        if (matches) {
            found = true;
            const parent = element.parentNode;
            const fragment = document.createDocumentFragment();
            let lastIndex = 0;
            matches.forEach(match => {
                const matchStart = element.textContent.indexOf(match, lastIndex);
                const matchEnd = matchStart + match.length;

                fragment.appendChild(document.createTextNode(element.textContent.slice(lastIndex, matchStart)));

                const span = document.createElement('span');
                span.className = 'highlight';
                span.textContent = match;
                fragment.appendChild(span);

                lastIndex = matchEnd;
                highlights.push(span);
            });

            fragment.appendChild(document.createTextNode(element.textContent.slice(lastIndex)));
            parent.replaceChild(fragment, element);
        }
        } else {
            Array.from(element.childNodes).forEach(child => {
                if (searchAndHighlight(child, searchTerm)) {
                    found = true;
                }
            });
        }

        // blog-card の表示・非表示の処理
        if (element.classList && element.classList.contains("blog-card")) {
            element.style.display = found ? "flex" : "none";
        }

        return found;
    }

        function resetHighlights() {
    highlights.forEach(el => {
        el.outerHTML = el.innerHTML;
    });
    highlights = [];
    currentIndex = -1;
    lastSearchTerm = '';

    // すべての blog-card を再表示
    document.querySelectorAll(".blog-card").forEach(card => {
        card.style.display = "flex";
    });
}
    var fieldtoclipboard = {
      tooltipobj: null,
      hidetooltiptimer: null,
      createtooltip:function(){
        var tooltip = document.createElement('div')
        tooltip.style.cssText = 
          'position:absolute; background:orangered; color:white; padding:1px 5px;z-index:10000;'
          + 'border-radius:8px; font-size:13px;box-shadow:3px 3px 3px rgba(0,0,0,.4);'
          + 'opacity:0;transition:opacity 0.9s'
        tooltip.innerHTML = '&nbsp;<i>Copied&nbsp;!</i>&nbsp;'
        this.tooltipobj = tooltip
        document.body.appendChild(tooltip)
      },
    showtooltip:function(e){
        var evt = e || event;
        clearTimeout(this.hidetooltiptimer);
        var tooltipWidth = this.tooltipobj.offsetWidth;
        var tooltipHeight = this.tooltipobj.offsetHeight;
        var left = evt.pageX - tooltipWidth / 2;
        var top = evt.pageY - tooltipHeight - 10;
        if (left < 0) left = 0;
        if (top < 0) top = 0;
        this.tooltipobj.style.left = left + 'px';
        this.tooltipobj.style.top = top + 'px';
        this.tooltipobj.style.opacity = 1;
        this.hidetooltiptimer = setTimeout(function(){
            fieldtoclipboard.tooltipobj.style.opacity = 0;
        }, 1500);
      },
      selectelement:function(el){
          var range = document.createRange() 
          range.selectNodeContents(el)
          var selection = window.getSelection()
          selection.removeAllRanges()
          selection.addRange(range)
      },
      copyfield:function(e, fieldref, callback){
        var field = (typeof fieldref == 'string') ? document.getElementById(fieldref) : fieldref
        if (/(textarea)|(input)/i.test(field) && field.setSelectionRange){
          field.focus()
          field.setSelectionRange(0, field.value.length)
        } else if (field && document.createRange) {
          this.selectelement(field)
        } else {
          return false
        }
    
        if (navigator.clipboard) {
          navigator.clipboard.writeText(field.value || window.getSelection().toString()).then(() => {
            this.showtooltip(e)
            if (callback) callback(field.value || window.getSelection().toString())
          }).catch(err => {
            console.error("Failed to copy text: ", err)
          })
        } else {
          try {
            document.execCommand("copy")
            this.showtooltip(e)
            if (callback) callback(field.value || window.getSelection().toString())
          } catch(e) {
            console.error("Failed to copy text: ", e)
          }
        }
        return false
      },
      init:function(){
        this.createtooltip()
      }
    }
    fieldtoclipboard.init()

        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const searchTerm = params.get('q');
            if (searchTerm) {
                document.getElementById('searchTerm').value = searchTerm;
                handleSearch(); // 検索機能があるなら自動実行
            }
        };

document.addEventListener("DOMContentLoaded", function () {
  const link = document.getElementById("how_to_use_link");
  const popup = document.getElementById("how_to_use_popup");
  const closeButton = document.getElementById("close_popup");

  // nav-menu を閉じる関数
  function closeNavMenu() {
    const navMenu = document.getElementById("nav-menu");
    if (navMenu.classList.contains("show")) {
      navMenu.classList.remove("show");
    }
  }

  // ポップアップを表示する処理
  link.addEventListener("click", function (event) {
    event.preventDefault(); // デフォルトのリンク動作を防止
    closeNavMenu(); // メニューを閉じる

    // 一度表示状態にしてから、次のフレームで .show を追加（transition有効）
    popup.style.display = "block";

    requestAnimationFrame(() => {
      popup.classList.add("show");
    });
  });

  // 閉じるボタンでポップアップ非表示
  closeButton.addEventListener("click", function () {
    popup.classList.remove("show");

    // アニメーションが終わった後に display: none に戻す
    setTimeout(() => {
      popup.style.display = "none";
    }, 400); // CSSのtransitionと合わせる（例: 0.4s）
  });

                 // ポップアップの外側をクリックしてもポップアップを閉じる (オプション)
        document.addEventListener("click", function(event) {
           if (popup.style.display === "block" && !popup.contains(event.target) && event.target !== link) {
             popup.style.display = "none";
             popup.classList.remove("show");
            }
         });
});

document.addEventListener("DOMContentLoaded", function () {
  const buttons = document.querySelectorAll(".tab-button");
  const contents = document.querySelectorAll(".tab-content");

  buttons.forEach(button => {
    button.addEventListener("click", () => {
      const target = button.getAttribute("data-tab");


      contents.forEach(tab => tab.style.display = "none");

      button.classList.add("active");
      document.getElementById(target).style.display = "block";
    });
  });
});

  document.addEventListener('DOMContentLoaded', function () {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    const underline = document.querySelector('.tab-underline');

    function updateUnderline(button) {
      const rect = button.getBoundingClientRect();
      const containerRect = button.parentElement.getBoundingClientRect();
      underline.style.left = (button.offsetLeft) + 'px';
      underline.style.width = button.offsetWidth + 'px';
    }

    tabButtons.forEach(button => {
      button.addEventListener('click', function () {
        const target = this.dataset.tab;

        // タブボタンのアクティブ切り替え
        tabButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');

        // アンダーラインの位置を更新
        updateUnderline(this);

        // タブコンテンツの切り替え（アニメーション）
        tabContents.forEach(content => {
          if (content.id === target) {
            content.classList.add('active');
          } else {
            content.classList.remove('active');
            // display: none はCSSで制御
          }
        });
      });
    });

    // 初期位置にアンダーラインを設定
    const initialActive = document.querySelector('.tab-button.active');
    if (initialActive) updateUnderline(initialActive);
  });
</script>

</body>
</html>